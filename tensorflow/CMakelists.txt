cmake_minimum_required(VERSION 3.18)

add_subdirectory(core)
#add_subdirectory(stream_executor)

set(CMAKE_SHARED_LINKER_FLAGS "-Wl,--export-all-symbols")
set(LINK_FLAGS ${LINK_FLAGS} "-Wl,-whole-archive")

add_library(tensorflow SHARED
    $<TARGET_OBJECTS:common_runtime>
    $<TARGET_OBJECTS:framework>
    $<TARGET_OBJECTS:graph>
    $<TARGET_OBJECTS:kernels>
    $<TARGET_OBJECTS:lib>
    $<TARGET_OBJECTS:ops>
    $<TARGET_OBJECTS:platform>
    $<TARGET_OBJECTS:util>
)
target_link_directories(tensorflow PUBLIC ${CMAKE_SOURCE_DIR}/external/re2/obj/)
target_link_libraries(tensorflow protobuf re2)
